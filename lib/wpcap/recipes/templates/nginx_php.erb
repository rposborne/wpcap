server {
  listen 80;
  server_name <%= application.chomp(".com")%>.burningpony.com, <%= application.chomp(".com")%>.kmdig.com, <%=application_url.gsub("http://", "")%> ;
  index index.php index.html index.htm;
  root <%= current_path %>/app;
  client_max_body_size 4G;
  keepalive_timeout 10;

  access_log          <%= shared_path %>/logs/access.log;
  error_log           <%= shared_path %>/logs/error.log;

  location  ^~ /assets/ {
    rewrite ^/assets/css/(.*)$ /wp-content/themes/cochrans/assets/css/$1 last;
    rewrite ^/assets/js/(.*)$ /wp-content/themes/cochrans/assets/js/$1 last;
    rewrite ^/assets/img/(.*)$ /wp-content/themes/cochrans/assets/img/$1 last;
    rewrite ^/plugins/(.*)$ /wp-content/plugins/$1 last;
  }
  
  location = /favicon.ico {
    log_not_found off;
    access_log off;
  }
  
  location = /robots.txt {
    allow all;
    log_not_found off;
    access_log off;
  }
  
  location  / {
    try_files $uri $uri/ /index.php?$args;
  }

  
  location ~ \.php$ {
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    fastcgi_pass unix:/var/run/php5-fpm.sock;
    fastcgi_index index.php;
    include fastcgi_params;
  }
  
  if (-f $document_root/system/maintenance.html) {
    return 503;
  }
  
  error_page 503 @maintenance;
  location @maintenance {
    rewrite  ^(.*)$  /system/maintenance.html last;
    break;
  }
  
  include <%= shared_path %>/config/nginx.conf;

}
